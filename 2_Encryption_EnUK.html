<!DOCTYPE HTML>
<html>
	<head>
		<title>Encrypt a message</title>
		<style>
		html{background-color:#DDD}body{-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;width:900px;margin:0 auto;font-family:Verdana,Helvetica,Arial,sans-serif;-webkit-box-shadow:0 0 10px 2px rgba(0,0,0,.5);-moz-box-shadow:0 0 10px 2px rgba(0,0,0,.5);box-shadow:0 0 10px 2px rgba(0,0,0,.5);padding:7px 25px 70px;background-color:#FFF}h1,h2,h3,h4,h5,h6{font-family:Georgia,"Times New Roman",serif}h2,form{text-align:center}form{margin-top:5px}.input{width:500px;height:300px;margin:0 auto;display:block}section{margin-top:40px}#canvas{cursor:crosshair}#canvas,#html{border:1px solid #000}.filename{text-align:right}#html{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;overflow:auto;padding:1em}.copyr{text-align: center;}.paragraph{padding:20px;}.button{text-decoration: none;background-color: #EEEEEE;color: #333333;padding: 2px 6px 2px 6px;border-top: 1px solid #CCCCCC;border-right: 1px solid #333333;border-bottom: 1px solid #333333;border-left: 1px solid #CCCCCC;}.custom-upload {cursor: pointer;background-color: #EEEEEE;color: #333333;padding: 2px 6px 2px 6px;border-top: 1px solid #CCCCCC;border-right: 1px solid #333333;border-bottom: 1px solid #333333;border-left: 1px solid #CCCCCC;}.custom-upload input {left: -9999px;position: absolute;}#inProgress{visibility:visible;display:none;position:fixed;top:0;left:0;width:100%;height:100%;text-align:center;background-color:#000;opacity:0.7;}#inProgress span{padding:15px;border-radius:5px;color:#000;background-color:#fff;position:relative;top:50%;}
		</style>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<script src="yourPrivateKey.txt"></script>
		<script src="yourCypherKey.txt"></script>
		<script>
<!--
// Labels in your language
var msg_tooLongForRSA = "Message too long for RSA";
var msg_invalidRSAPublicKey = "Invalid RSA public key";
var msg_invalidRSAPrivateKey = "Invalid RSA private key";
var lblAttachment = "Attachment"; //'Pièce jointe';
var lblUpload = "Upload";
var lblErrorInvalidPublicKey = "ERROR: this cypher key is not valid! Something went wront durint the previous steps of the process."; //"ERREUR: la clé publique donnée n'est pas valide !";
var lblForwardInnerHTML = "Download and send the following encrypted message. The name of the message is not important, it can be modified to go unnoticed. \n"
		+"The first time you send an encrypted message to someone, send also the file named \"2_Decryption_EnUK.html\" which function is self-explanatory. \n"
		+"This will not be necessary anymore for the next messages to the same person, the same page could be used for decrypting them.\n";
var lbl_nameFileYourEncryptedMessage = "yourEncryptedMessage.txt";
var lbl_yourEncryptedMessage = "Your encrypted message";
var lbl_poweredBy = "powered by";

// Minified jsbn.js from JSBN library
var dbits;var canary=244837814094590;var j_lm=((canary&16777215)==15715070);function BigInteger(e,d,f){if(e!=null){if("number"==typeof e){this.fromNumber(e,d,f)}else{if(d==null&&"string"!=typeof e){this.fromString(e,256)}else{this.fromString(e,d)}}}}function nbi(){return new BigInteger(null)}function am1(f,a,b,e,h,g){while(--g>=0){var d=a*this[f++]+b[e]+h;h=Math.floor(d/67108864);b[e++]=d&67108863}return h}function am2(f,q,r,e,o,a){var k=q&32767,p=q>>15;while(--a>=0){var d=this[f]&32767;var g=this[f++]>>15;var b=p*d+g*k;d=k*d+((b&32767)<<15)+r[e]+(o&1073741823);o=(d>>>30)+(b>>>15)+p*g+(o>>>30);r[e++]=d&1073741823}return o}function am3(f,q,r,e,o,a){var k=q&16383,p=q>>14;while(--a>=0){var d=this[f]&16383;var g=this[f++]>>14;var b=p*d+g*k;d=k*d+((b&16383)<<14)+r[e]+o;o=(d>>28)+(b>>14)+p*g;r[e++]=d&268435455}return o}if(j_lm&&(navigator.appName=="Microsoft Internet Explorer")){BigInteger.prototype.am=am2;dbits=30}else{if(j_lm&&(navigator.appName!="Netscape")){BigInteger.prototype.am=am1;dbits=26}else{BigInteger.prototype.am=am3;dbits=28}}BigInteger.prototype.DB=dbits;BigInteger.prototype.DM=((1<<dbits)-1);BigInteger.prototype.DV=(1<<dbits);var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP);BigInteger.prototype.F1=BI_FP-dbits;BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz";var BI_RC=new Array();var rr,vv;rr="0".charCodeAt(0);for(vv=0;vv<=9;++vv){BI_RC[rr++]=vv}rr="a".charCodeAt(0);for(vv=10;vv<36;++vv){BI_RC[rr++]=vv}rr="A".charCodeAt(0);for(vv=10;vv<36;++vv){BI_RC[rr++]=vv}function int2char(a){return BI_RM.charAt(a)}function intAt(b,a){var d=BI_RC[b.charCodeAt(a)];return(d==null)?-1:d}function bnpCopyTo(b){for(var a=this.t-1;a>=0;--a){b[a]=this[a]}b.t=this.t;b.s=this.s}function bnpFromInt(a){this.t=1;this.s=(a<0)?-1:0;if(a>0){this[0]=a}else{if(a<-1){this[0]=a+this.DV}else{this.t=0}}}function nbv(a){var b=nbi();b.fromInt(a);return b}function bnpFromString(h,c){var e;if(c==16){e=4}else{if(c==8){e=3}else{if(c==256){e=8}else{if(c==2){e=1}else{if(c==32){e=5}else{if(c==4){e=2}else{this.fromRadix(h,c);return}}}}}}this.t=0;this.s=0;var g=h.length,d=false,f=0;while(--g>=0){var a=(e==8)?h[g]&255:intAt(h,g);if(a<0){if(h.charAt(g)=="-"){d=true}continue}d=false;if(f==0){this[this.t++]=a}else{if(f+e>this.DB){this[this.t-1]|=(a&((1<<(this.DB-f))-1))<<f;this[this.t++]=(a>>(this.DB-f))}else{this[this.t-1]|=a<<f}}f+=e;if(f>=this.DB){f-=this.DB}}if(e==8&&(h[0]&128)!=0){this.s=-1;if(f>0){this[this.t-1]|=((1<<(this.DB-f))-1)<<f}}this.clamp();if(d){BigInteger.ZERO.subTo(this,this)}}function bnpClamp(){var a=this.s&this.DM;while(this.t>0&&this[this.t-1]==a){--this.t}}function bnToString(c){if(this.s<0){return"-"+this.negate().toString(c)}var e;if(c==16){e=4}else{if(c==8){e=3}else{if(c==2){e=1}else{if(c==32){e=5}else{if(c==4){e=2}else{return this.toRadix(c)}}}}}var g=(1<<e)-1,l,a=false,h="",f=this.t;var j=this.DB-(f*this.DB)%e;if(f-- >0){if(j<this.DB&&(l=this[f]>>j)>0){a=true;h=int2char(l)}while(f>=0){if(j<e){l=(this[f]&((1<<j)-1))<<(e-j);l|=this[--f]>>(j+=this.DB-e)}else{l=(this[f]>>(j-=e))&g;if(j<=0){j+=this.DB;--f}}if(l>0){a=true}if(a){h+=int2char(l)}}}return a?h:"0"}function bnNegate(){var a=nbi();BigInteger.ZERO.subTo(this,a);return a}function bnAbs(){return(this.s<0)?this.negate():this}function bnCompareTo(b){var d=this.s-b.s;if(d!=0){return d}var c=this.t;d=c-b.t;if(d!=0){return(this.s<0)?-d:d}while(--c>=0){if((d=this[c]-b[c])!=0){return d}}return 0}function nbits(a){var c=1,b;if((b=a>>>16)!=0){a=b;c+=16}if((b=a>>8)!=0){a=b;c+=8}if((b=a>>4)!=0){a=b;c+=4}if((b=a>>2)!=0){a=b;c+=2}if((b=a>>1)!=0){a=b;c+=1}return c}function bnBitLength(){if(this.t<=0){return 0}return this.DB*(this.t-1)+nbits(this[this.t-1]^(this.s&this.DM))}function bnpDLShiftTo(c,b){var a;for(a=this.t-1;a>=0;--a){b[a+c]=this[a]}for(a=c-1;a>=0;--a){b[a]=0}b.t=this.t+c;b.s=this.s}function bnpDRShiftTo(c,b){for(var a=c;a<this.t;++a){b[a-c]=this[a]}b.t=Math.max(this.t-c,0);b.s=this.s}function bnpLShiftTo(j,e){var b=j%this.DB;var a=this.DB-b;var g=(1<<a)-1;var f=Math.floor(j/this.DB),h=(this.s<<b)&this.DM,d;for(d=this.t-1;d>=0;--d){e[d+f+1]=(this[d]>>a)|h;h=(this[d]&g)<<b}for(d=f-1;d>=0;--d){e[d]=0}e[f]=h;e.t=this.t+f+1;e.s=this.s;e.clamp()}function bnpRShiftTo(g,d){d.s=this.s;var e=Math.floor(g/this.DB);if(e>=this.t){d.t=0;return}var b=g%this.DB;var a=this.DB-b;var f=(1<<b)-1;d[0]=this[e]>>b;for(var c=e+1;c<this.t;++c){d[c-e-1]|=(this[c]&f)<<a;d[c-e]=this[c]>>b}if(b>0){d[this.t-e-1]|=(this.s&f)<<a}d.t=this.t-e;d.clamp()}function bnpSubTo(d,f){var e=0,g=0,b=Math.min(d.t,this.t);while(e<b){g+=this[e]-d[e];f[e++]=g&this.DM;g>>=this.DB}if(d.t<this.t){g-=d.s;while(e<this.t){g+=this[e];f[e++]=g&this.DM;g>>=this.DB}g+=this.s}else{g+=this.s;while(e<d.t){g-=d[e];f[e++]=g&this.DM;g>>=this.DB}g-=d.s}f.s=(g<0)?-1:0;if(g<-1){f[e++]=this.DV+g}else{if(g>0){f[e++]=g}}f.t=e;f.clamp()}function bnpMultiplyTo(c,e){var b=this.abs(),f=c.abs();var d=b.t;e.t=d+f.t;while(--d>=0){e[d]=0}for(d=0;d<f.t;++d){e[d+b.t]=b.am(0,f[d],e,d,0,b.t)}e.s=0;e.clamp();if(this.s!=c.s){BigInteger.ZERO.subTo(e,e)}}function bnpSquareTo(d){var a=this.abs();var b=d.t=2*a.t;while(--b>=0){d[b]=0}for(b=0;b<a.t-1;++b){var e=a.am(b,a[b],d,2*b,0,1);if((d[b+a.t]+=a.am(b+1,2*a[b],d,2*b+1,e,a.t-b-1))>=a.DV){d[b+a.t]-=a.DV;d[b+a.t+1]=1}}if(d.t>0){d[d.t-1]+=a.am(b,a[b],d,2*b,0,1)}d.s=0;d.clamp()}function bnpDivRemTo(n,h,g){var w=n.abs();if(w.t<=0){return}var k=this.abs();if(k.t<w.t){if(h!=null){h.fromInt(0)}if(g!=null){this.copyTo(g)}return}if(g==null){g=nbi()}var d=nbi(),a=this.s,l=n.s;var v=this.DB-nbits(w[w.t-1]);if(v>0){w.lShiftTo(v,d);k.lShiftTo(v,g)}else{w.copyTo(d);k.copyTo(g)}var p=d.t;var b=d[p-1];if(b==0){return}var o=b*(1<<this.F1)+((p>1)?d[p-2]>>this.F2:0);var A=this.FV/o,z=(1<<this.F1)/o,x=1<<this.F2;var u=g.t,s=u-p,f=(h==null)?nbi():h;d.dlShiftTo(s,f);if(g.compareTo(f)>=0){g[g.t++]=1;g.subTo(f,g)}BigInteger.ONE.dlShiftTo(p,f);f.subTo(d,d);while(d.t<p){d[d.t++]=0}while(--s>=0){var c=(g[--u]==b)?this.DM:Math.floor(g[u]*A+(g[u-1]+x)*z);if((g[u]+=d.am(0,c,g,s,0,p))<c){d.dlShiftTo(s,f);g.subTo(f,g);while(g[u]<--c){g.subTo(f,g)}}}if(h!=null){g.drShiftTo(p,h);if(a!=l){BigInteger.ZERO.subTo(h,h)}}g.t=p;g.clamp();if(v>0){g.rShiftTo(v,g)}if(a<0){BigInteger.ZERO.subTo(g,g)}}function bnMod(b){var c=nbi();this.abs().divRemTo(b,null,c);if(this.s<0&&c.compareTo(BigInteger.ZERO)>0){b.subTo(c,c)}return c}function Classic(a){this.m=a}function cConvert(a){if(a.s<0||a.compareTo(this.m)>=0){return a.mod(this.m)}else{return a}}function cRevert(a){return a}function cReduce(a){a.divRemTo(this.m,null,a)}function cMulTo(a,c,b){a.multiplyTo(c,b);this.reduce(b)}function cSqrTo(a,b){a.squareTo(b);this.reduce(b)}Classic.prototype.convert=cConvert;Classic.prototype.revert=cRevert;Classic.prototype.reduce=cReduce;Classic.prototype.mulTo=cMulTo;Classic.prototype.sqrTo=cSqrTo;function bnpInvDigit(){if(this.t<1){return 0}var a=this[0];if((a&1)==0){return 0}var b=a&3;b=(b*(2-(a&15)*b))&15;b=(b*(2-(a&255)*b))&255;b=(b*(2-(((a&65535)*b)&65535)))&65535;b=(b*(2-a*b%this.DV))%this.DV;return(b>0)?this.DV-b:-b}function Montgomery(a){this.m=a;this.mp=a.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<(a.DB-15))-1;this.mt2=2*a.t}function montConvert(a){var b=nbi();a.abs().dlShiftTo(this.m.t,b);b.divRemTo(this.m,null,b);if(a.s<0&&b.compareTo(BigInteger.ZERO)>0){this.m.subTo(b,b)}return b}function montRevert(a){var b=nbi();a.copyTo(b);this.reduce(b);return b}function montReduce(a){while(a.t<=this.mt2){a[a.t++]=0}for(var c=0;c<this.m.t;++c){var b=a[c]&32767;var d=(b*this.mpl+(((b*this.mph+(a[c]>>15)*this.mpl)&this.um)<<15))&a.DM;b=c+this.m.t;a[b]+=this.m.am(0,d,a,c,0,this.m.t);while(a[b]>=a.DV){a[b]-=a.DV;a[++b]++}}a.clamp();a.drShiftTo(this.m.t,a);if(a.compareTo(this.m)>=0){a.subTo(this.m,a)}}function montSqrTo(a,b){a.squareTo(b);this.reduce(b)}function montMulTo(a,c,b){a.multiplyTo(c,b);this.reduce(b)}Montgomery.prototype.convert=montConvert;Montgomery.prototype.revert=montRevert;Montgomery.prototype.reduce=montReduce;Montgomery.prototype.mulTo=montMulTo;Montgomery.prototype.sqrTo=montSqrTo;function bnpIsEven(){return((this.t>0)?(this[0]&1):this.s)==0}function bnpExp(h,j){if(h>4294967295||h<1){return BigInteger.ONE}var f=nbi(),a=nbi(),d=j.convert(this),c=nbits(h)-1;d.copyTo(f);while(--c>=0){j.sqrTo(f,a);if((h&(1<<c))>0){j.mulTo(a,d,f)}else{var b=f;f=a;a=b}}return j.revert(f)}function bnModPowInt(b,a){var c;if(b<256||a.isEven()){c=new Classic(a)}else{c=new Montgomery(a)}return this.exp(b,c)}BigInteger.prototype.copyTo=bnpCopyTo;BigInteger.prototype.fromInt=bnpFromInt;BigInteger.prototype.fromString=bnpFromString;BigInteger.prototype.clamp=bnpClamp;BigInteger.prototype.dlShiftTo=bnpDLShiftTo;BigInteger.prototype.drShiftTo=bnpDRShiftTo;BigInteger.prototype.lShiftTo=bnpLShiftTo;BigInteger.prototype.rShiftTo=bnpRShiftTo;BigInteger.prototype.subTo=bnpSubTo;BigInteger.prototype.multiplyTo=bnpMultiplyTo;BigInteger.prototype.squareTo=bnpSquareTo;BigInteger.prototype.divRemTo=bnpDivRemTo;BigInteger.prototype.invDigit=bnpInvDigit;BigInteger.prototype.isEven=bnpIsEven;BigInteger.prototype.exp=bnpExp;BigInteger.prototype.toString=bnToString;BigInteger.prototype.negate=bnNegate;BigInteger.prototype.abs=bnAbs;BigInteger.prototype.compareTo=bnCompareTo;BigInteger.prototype.bitLength=bnBitLength;BigInteger.prototype.mod=bnMod;BigInteger.prototype.modPowInt=bnModPowInt;BigInteger.ZERO=nbv(0);BigInteger.ONE=nbv(1);
// Minified jsbn2.js from JSBN library
function bnClone(){var a=nbi();this.copyTo(a);return a}function bnIntValue(){if(this.s<0){if(this.t==1){return this[0]-this.DV}else{if(this.t==0){return -1}}}else{if(this.t==1){return this[0]}else{if(this.t==0){return 0}}}return((this[1]&((1<<(32-this.DB))-1))<<this.DB)|this[0]}function bnByteValue(){return(this.t==0)?this.s:(this[0]<<24)>>24}function bnShortValue(){return(this.t==0)?this.s:(this[0]<<16)>>16}function bnpChunkSize(a){return Math.floor(Math.LN2*this.DB/Math.log(a))}function bnSigNum(){if(this.s<0){return -1}else{if(this.t<=0||(this.t==1&&this[0]<=0)){return 0}else{return 1}}}function bnpToRadix(c){if(c==null){c=10}if(this.signum()==0||c<2||c>36){return"0"}var f=this.chunkSize(c);var e=Math.pow(c,f);var i=nbv(e),j=nbi(),h=nbi(),g="";this.divRemTo(i,j,h);while(j.signum()>0){g=(e+h.intValue()).toString(c).substr(1)+g;j.divRemTo(i,j,h)}return h.intValue().toString(c)+g}function bnpFromRadix(m,h){this.fromInt(0);if(h==null){h=10}var f=this.chunkSize(h);var g=Math.pow(h,f),e=false,a=0,l=0;for(var c=0;c<m.length;++c){var k=intAt(m,c);if(k<0){if(m.charAt(c)=="-"&&this.signum()==0){e=true}continue}l=h*l+k;if(++a>=f){this.dMultiply(g);this.dAddOffset(l,0);a=0;l=0}}if(a>0){this.dMultiply(Math.pow(h,a));this.dAddOffset(l,0)}if(e){BigInteger.ZERO.subTo(this,this)}}function bnpFromNumber(f,e,h){if("number"==typeof e){if(f<2){this.fromInt(1)}else{this.fromNumber(f,h);if(!this.testBit(f-1)){this.bitwiseTo(BigInteger.ONE.shiftLeft(f-1),op_or,this)}if(this.isEven()){this.dAddOffset(1,0)}while(!this.isProbablePrime(e)){this.dAddOffset(2,0);if(this.bitLength()>f){this.subTo(BigInteger.ONE.shiftLeft(f-1),this)}}}}else{var d=new Array(),g=f&7;d.length=(f>>3)+1;e.nextBytes(d);if(g>0){d[0]&=((1<<g)-1)}else{d[0]=0}this.fromString(d,256)}}function bnToByteArray(){var b=this.t,c=new Array();c[0]=this.s;var e=this.DB-(b*this.DB)%8,f,a=0;if(b-- >0){if(e<this.DB&&(f=this[b]>>e)!=(this.s&this.DM)>>e){c[a++]=f|(this.s<<(this.DB-e))}while(b>=0){if(e<8){f=(this[b]&((1<<e)-1))<<(8-e);f|=this[--b]>>(e+=this.DB-8)}else{f=(this[b]>>(e-=8))&255;if(e<=0){e+=this.DB;--b}}if((f&128)!=0){f|=-256}if(a==0&&(this.s&128)!=(f&128)){++a}if(a>0||f!=this.s){c[a++]=f}}}return c}function bnEquals(b){return(this.compareTo(b)==0)}function bnMin(b){return(this.compareTo(b)<0)?this:b}function bnMax(b){return(this.compareTo(b)>0)?this:b}function bnpBitwiseTo(c,h,e){var d,g,b=Math.min(c.t,this.t);for(d=0;d<b;++d){e[d]=h(this[d],c[d])}if(c.t<this.t){g=c.s&this.DM;for(d=b;d<this.t;++d){e[d]=h(this[d],g)}e.t=this.t}else{g=this.s&this.DM;for(d=b;d<c.t;++d){e[d]=h(g,c[d])}e.t=c.t}e.s=h(this.s,c.s);e.clamp()}function op_and(a,b){return a&b}function bnAnd(b){var c=nbi();this.bitwiseTo(b,op_and,c);return c}function op_or(a,b){return a|b}function bnOr(b){var c=nbi();this.bitwiseTo(b,op_or,c);return c}function op_xor(a,b){return a^b}function bnXor(b){var c=nbi();this.bitwiseTo(b,op_xor,c);return c}function op_andnot(a,b){return a&~b}function bnAndNot(b){var c=nbi();this.bitwiseTo(b,op_andnot,c);return c}function bnNot(){var b=nbi();for(var a=0;a<this.t;++a){b[a]=this.DM&~this[a]}b.t=this.t;b.s=~this.s;return b}function bnShiftLeft(b){var a=nbi();if(b<0){this.rShiftTo(-b,a)}else{this.lShiftTo(b,a)}return a}function bnShiftRight(b){var a=nbi();if(b<0){this.lShiftTo(-b,a)}else{this.rShiftTo(b,a)}return a}function lbit(a){if(a==0){return -1}var b=0;if((a&65535)==0){a>>=16;b+=16}if((a&255)==0){a>>=8;b+=8}if((a&15)==0){a>>=4;b+=4}if((a&3)==0){a>>=2;b+=2}if((a&1)==0){++b}return b}function bnGetLowestSetBit(){for(var a=0;a<this.t;++a){if(this[a]!=0){return a*this.DB+lbit(this[a])}}if(this.s<0){return this.t*this.DB}return -1}function cbit(a){var b=0;while(a!=0){a&=a-1;++b}return b}function bnBitCount(){var c=0,a=this.s&this.DM;for(var b=0;b<this.t;++b){c+=cbit(this[b]^a)}return c}function bnTestBit(b){var a=Math.floor(b/this.DB);if(a>=this.t){return(this.s!=0)}return((this[a]&(1<<(b%this.DB)))!=0)}function bnpChangeBit(c,b){var a=BigInteger.ONE.shiftLeft(c);this.bitwiseTo(a,b,a);return a}function bnSetBit(a){return this.changeBit(a,op_or)}function bnClearBit(a){return this.changeBit(a,op_andnot)}function bnFlipBit(a){return this.changeBit(a,op_xor)}function bnpAddTo(d,f){var e=0,g=0,b=Math.min(d.t,this.t);while(e<b){g+=this[e]+d[e];f[e++]=g&this.DM;g>>=this.DB}if(d.t<this.t){g+=d.s;while(e<this.t){g+=this[e];f[e++]=g&this.DM;g>>=this.DB}g+=this.s}else{g+=this.s;while(e<d.t){g+=d[e];f[e++]=g&this.DM;g>>=this.DB}g+=d.s}f.s=(g<0)?-1:0;if(g>0){f[e++]=g}else{if(g<-1){f[e++]=this.DV+g}}f.t=e;f.clamp()}function bnAdd(b){var c=nbi();this.addTo(b,c);return c}function bnSubtract(b){var c=nbi();this.subTo(b,c);return c}function bnMultiply(b){var c=nbi();this.multiplyTo(b,c);return c}function bnSquare(){var a=nbi();this.squareTo(a);return a}function bnDivide(b){var c=nbi();this.divRemTo(b,c,null);return c}function bnRemainder(b){var c=nbi();this.divRemTo(b,null,c);return c}function bnDivideAndRemainder(b){var d=nbi(),c=nbi();this.divRemTo(b,d,c);return new Array(d,c)}function bnpDMultiply(a){this[this.t]=this.am(0,a-1,this,0,0,this.t);++this.t;this.clamp()}function bnpDAddOffset(b,a){if(b==0){return}while(this.t<=a){this[this.t++]=0}this[a]+=b;while(this[a]>=this.DV){this[a]-=this.DV;if(++a>=this.t){this[this.t++]=0}++this[a]}}function NullExp(){}function nNop(a){return a}function nMulTo(a,c,b){a.multiplyTo(c,b)}function nSqrTo(a,b){a.squareTo(b)}NullExp.prototype.convert=nNop;NullExp.prototype.revert=nNop;NullExp.prototype.mulTo=nMulTo;NullExp.prototype.sqrTo=nSqrTo;function bnPow(a){return this.exp(a,new NullExp())}function bnpMultiplyLowerTo(b,f,e){var d=Math.min(this.t+b.t,f);e.s=0;e.t=d;while(d>0){e[--d]=0}var c;for(c=e.t-this.t;d<c;++d){e[d+this.t]=this.am(0,b[d],e,d,0,this.t)}for(c=Math.min(b.t,f);d<c;++d){this.am(0,b[d],e,d,0,f-d)}e.clamp()}function bnpMultiplyUpperTo(b,e,d){--e;var c=d.t=this.t+b.t-e;d.s=0;while(--c>=0){d[c]=0}for(c=Math.max(e-this.t,0);c<b.t;++c){d[this.t+c-e]=this.am(e-c,b[c],d,0,0,this.t+c-e)}d.clamp();d.drShiftTo(1,d)}function Barrett(a){this.r2=nbi();this.q3=nbi();BigInteger.ONE.dlShiftTo(2*a.t,this.r2);this.mu=this.r2.divide(a);this.m=a}function barrettConvert(a){if(a.s<0||a.t>2*this.m.t){return a.mod(this.m)}else{if(a.compareTo(this.m)<0){return a}else{var b=nbi();a.copyTo(b);this.reduce(b);return b}}}function barrettRevert(a){return a}function barrettReduce(a){a.drShiftTo(this.m.t-1,this.r2);if(a.t>this.m.t+1){a.t=this.m.t+1;a.clamp()}this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(a.compareTo(this.r2)<0){a.dAddOffset(1,this.m.t+1)}a.subTo(this.r2,a);while(a.compareTo(this.m)>=0){a.subTo(this.m,a)}}function barrettSqrTo(a,b){a.squareTo(b);this.reduce(b)}function barrettMulTo(a,c,b){a.multiplyTo(c,b);this.reduce(b)}Barrett.prototype.convert=barrettConvert;Barrett.prototype.revert=barrettRevert;Barrett.prototype.reduce=barrettReduce;Barrett.prototype.mulTo=barrettMulTo;Barrett.prototype.sqrTo=barrettSqrTo;function bnModPow(q,f){var o=q.bitLength(),h,b=nbv(1),v;if(o<=0){return b}else{if(o<18){h=1}else{if(o<48){h=3}else{if(o<144){h=4}else{if(o<768){h=5}else{h=6}}}}}if(o<8){v=new Classic(f)}else{if(f.isEven()){v=new Barrett(f)}else{v=new Montgomery(f)}}var p=new Array(),d=3,s=h-1,a=(1<<h)-1;p[1]=v.convert(this);if(h>1){var A=nbi();v.sqrTo(p[1],A);while(d<=a){p[d]=nbi();v.mulTo(A,p[d-2],p[d]);d+=2}}var l=q.t-1,x,u=true,c=nbi(),y;o=nbits(q[l])-1;while(l>=0){if(o>=s){x=(q[l]>>(o-s))&a}else{x=(q[l]&((1<<(o+1))-1))<<(s-o);if(l>0){x|=q[l-1]>>(this.DB+o-s)}}d=h;while((x&1)==0){x>>=1;--d}if((o-=d)<0){o+=this.DB;--l}if(u){p[x].copyTo(b);u=false}else{while(d>1){v.sqrTo(b,c);v.sqrTo(c,b);d-=2}if(d>0){v.sqrTo(b,c)}else{y=b;b=c;c=y}v.mulTo(c,p[x],b)}while(l>=0&&(q[l]&(1<<o))==0){v.sqrTo(b,c);y=b;b=c;c=y;if(--o<0){o=this.DB-1;--l}}}return v.revert(b)}function bnGCD(c){var b=(this.s<0)?this.negate():this.clone();var h=(c.s<0)?c.negate():c.clone();if(b.compareTo(h)<0){var e=b;b=h;h=e}var d=b.getLowestSetBit(),f=h.getLowestSetBit();if(f<0){return b}if(d<f){f=d}if(f>0){b.rShiftTo(f,b);h.rShiftTo(f,h)}while(b.signum()>0){if((d=b.getLowestSetBit())>0){b.rShiftTo(d,b)}if((d=h.getLowestSetBit())>0){h.rShiftTo(d,h)}if(b.compareTo(h)>=0){b.subTo(h,b);b.rShiftTo(1,b)}else{h.subTo(b,h);h.rShiftTo(1,h)}}if(f>0){h.lShiftTo(f,h)}return h}function bnpModInt(e){if(e<=0){return 0}var c=this.DV%e,b=(this.s<0)?e-1:0;if(this.t>0){if(c==0){b=this[0]%e}else{for(var a=this.t-1;a>=0;--a){b=(c*b+this[a])%e}}}return b}function bnModInverse(f){var j=f.isEven();if((this.isEven()&&j)||f.signum()==0){return BigInteger.ZERO}var i=f.clone(),h=this.clone();var g=nbv(1),e=nbv(0),l=nbv(0),k=nbv(1);while(i.signum()!=0){while(i.isEven()){i.rShiftTo(1,i);if(j){if(!g.isEven()||!e.isEven()){g.addTo(this,g);e.subTo(f,e)}g.rShiftTo(1,g)}else{if(!e.isEven()){e.subTo(f,e)}}e.rShiftTo(1,e)}while(h.isEven()){h.rShiftTo(1,h);if(j){if(!l.isEven()||!k.isEven()){l.addTo(this,l);k.subTo(f,k)}l.rShiftTo(1,l)}else{if(!k.isEven()){k.subTo(f,k)}}k.rShiftTo(1,k)}if(i.compareTo(h)>=0){i.subTo(h,i);if(j){g.subTo(l,g)}e.subTo(k,e)}else{h.subTo(i,h);if(j){l.subTo(g,l)}k.subTo(e,k)}}if(h.compareTo(BigInteger.ONE)!=0){return BigInteger.ZERO}if(k.compareTo(f)>=0){return k.subtract(f)}if(k.signum()<0){k.addTo(f,k)}else{return k}if(k.signum()<0){return k.add(f)}else{return k}}var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997];var lplim=(1<<26)/lowprimes[lowprimes.length-1];function bnIsProbablePrime(e){var d,b=this.abs();if(b.t==1&&b[0]<=lowprimes[lowprimes.length-1]){for(d=0;d<lowprimes.length;++d){if(b[0]==lowprimes[d]){return true}}return false}if(b.isEven()){return false}d=1;while(d<lowprimes.length){var a=lowprimes[d],c=d+1;while(c<lowprimes.length&&a<lplim){a*=lowprimes[c++]}a=b.modInt(a);while(d<c){if(a%lowprimes[d++]==0){return false}}}return b.millerRabin(e)}function bnpMillerRabin(f){var g=this.subtract(BigInteger.ONE);var c=g.getLowestSetBit();if(c<=0){return false}var h=g.shiftRight(c);f=(f+1)>>1;if(f>lowprimes.length){f=lowprimes.length}var b=nbi();for(var e=0;e<f;++e){b.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var l=b.modPow(h,this);if(l.compareTo(BigInteger.ONE)!=0&&l.compareTo(g)!=0){var d=1;while(d++<c&&l.compareTo(g)!=0){l=l.modPowInt(2,this);if(l.compareTo(BigInteger.ONE)==0){return false}}if(l.compareTo(g)!=0){return false}}}return true}BigInteger.prototype.chunkSize=bnpChunkSize;BigInteger.prototype.toRadix=bnpToRadix;BigInteger.prototype.fromRadix=bnpFromRadix;BigInteger.prototype.fromNumber=bnpFromNumber;BigInteger.prototype.bitwiseTo=bnpBitwiseTo;BigInteger.prototype.changeBit=bnpChangeBit;BigInteger.prototype.addTo=bnpAddTo;BigInteger.prototype.dMultiply=bnpDMultiply;BigInteger.prototype.dAddOffset=bnpDAddOffset;BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo;BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo;BigInteger.prototype.modInt=bnpModInt;BigInteger.prototype.millerRabin=bnpMillerRabin;BigInteger.prototype.clone=bnClone;BigInteger.prototype.intValue=bnIntValue;BigInteger.prototype.byteValue=bnByteValue;BigInteger.prototype.shortValue=bnShortValue;BigInteger.prototype.signum=bnSigNum;BigInteger.prototype.toByteArray=bnToByteArray;BigInteger.prototype.equals=bnEquals;BigInteger.prototype.min=bnMin;BigInteger.prototype.max=bnMax;BigInteger.prototype.and=bnAnd;BigInteger.prototype.or=bnOr;BigInteger.prototype.xor=bnXor;BigInteger.prototype.andNot=bnAndNot;BigInteger.prototype.not=bnNot;BigInteger.prototype.shiftLeft=bnShiftLeft;BigInteger.prototype.shiftRight=bnShiftRight;BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit;BigInteger.prototype.bitCount=bnBitCount;BigInteger.prototype.testBit=bnTestBit;BigInteger.prototype.setBit=bnSetBit;BigInteger.prototype.clearBit=bnClearBit;BigInteger.prototype.flipBit=bnFlipBit;BigInteger.prototype.add=bnAdd;BigInteger.prototype.subtract=bnSubtract;BigInteger.prototype.multiply=bnMultiply;BigInteger.prototype.divide=bnDivide;BigInteger.prototype.remainder=bnRemainder;BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder;BigInteger.prototype.modPow=bnModPow;BigInteger.prototype.modInverse=bnModInverse;BigInteger.prototype.pow=bnPow;BigInteger.prototype.gcd=bnGCD;BigInteger.prototype.isProbablePrime=bnIsProbablePrime;BigInteger.prototype.square=bnSquare;
// Minified prng4.js from JSBN library
function Arcfour(){this.i=0;this.j=0;this.S=new Array()}function ARC4init(d){var c,a,b;for(c=0;c<256;++c){this.S[c]=c}a=0;for(c=0;c<256;++c){a=(a+this.S[c]+d[c%d.length])&255;b=this.S[c];this.S[c]=this.S[a];this.S[a]=b}this.i=0;this.j=0}function ARC4next(){var a;this.i=(this.i+1)&255;this.j=(this.j+this.S[this.i])&255;a=this.S[this.i];this.S[this.i]=this.S[this.j];this.S[this.j]=a;return this.S[(a+this.S[this.i])&255]}Arcfour.prototype.init=ARC4init;Arcfour.prototype.next=ARC4next;function prng_newstate(){return new Arcfour()}var rng_psize=256;
// Minified rng.js from JSBN library
var rng_state;var rng_pool;var rng_pptr;function rng_seed_int(a){rng_pool[rng_pptr++]^=a&255;rng_pool[rng_pptr++]^=(a>>8)&255;rng_pool[rng_pptr++]^=(a>>16)&255;rng_pool[rng_pptr++]^=(a>>24)&255;if(rng_pptr>=rng_psize){rng_pptr-=rng_psize}}function rng_seed_time(){rng_seed_int(new Date().getTime())}if(rng_pool==null){rng_pool=new Array();rng_pptr=0;var t;if(window.crypto&&window.crypto.getRandomValues){var ua=new Uint8Array(32);window.crypto.getRandomValues(ua);for(t=0;t<32;++t){rng_pool[rng_pptr++]=ua[t]}}if(navigator.appName=="Netscape"&&navigator.appVersion<"5"&&window.crypto){var z=window.crypto.random(32);for(t=0;t<z.length;++t){rng_pool[rng_pptr++]=z.charCodeAt(t)&255}}while(rng_pptr<rng_psize){t=Math.floor(65536*Math.random());rng_pool[rng_pptr++]=t>>>8;rng_pool[rng_pptr++]=t&255}rng_pptr=0;rng_seed_time()}function rng_get_byte(){if(rng_state==null){rng_seed_time();rng_state=prng_newstate();rng_state.init(rng_pool);for(rng_pptr=0;rng_pptr<rng_pool.length;++rng_pptr){rng_pool[rng_pptr]=0}rng_pptr=0}return rng_state.next()}function rng_get_bytes(b){var a;for(a=0;a<b.length;++a){b[a]=rng_get_byte()}}function SecureRandom(){}SecureRandom.prototype.nextBytes=rng_get_bytes;
// Minified and modified rsa.js from JSBN library
function parseBigInt(b,a){return new BigInteger(b,a)}function linebrk(c,d){var a="";var b=0;while(b+d<c.length){a+=c.substring(b,b+d)+"\n";b+=d}return a+c.substring(b,c.length)}function byte2Hex(a){if(a<16){return"0"+a.toString(16)}else{return a.toString(16)}}function pkcs1pad2(e,h){if(h<e.length+11){alert(msg_tooLongForRSA);return null}var g=new Array();var d=e.length-1;while(d>=0&&h>0){var f=e.charCodeAt(d--);if(f<128){g[--h]=f}else{if((f>127)&&(f<2048)){g[--h]=(f&63)|128;g[--h]=(f>>6)|192}else{g[--h]=(f&63)|128;g[--h]=((f>>6)&63)|128;g[--h]=(f>>12)|224}}}g[--h]=0;var b=new SecureRandom();var a=new Array();while(h>2){a[0]=0;while(a[0]==0){b.nextBytes(a)}g[--h]=a[0]}g[--h]=2;g[--h]=0;return new BigInteger(g)}function RSAKey(){this.n=null;this.e=0;this.d=null;this.p=null;this.q=null;this.dmp1=null;this.dmq1=null;this.coeff=null}function RSASetPublic(b,a){if(b!=null&&a!=null&&b.length>0&&a.length>0){this.n=parseBigInt(b,16);this.e=parseInt(a,16)}else{alert(msg_invalidRSAPublicKey)}}function RSADoPublic(a){return a.modPowInt(this.e,this.n)}function RSAEncrypt(d){var a=pkcs1pad2(d,(this.n.bitLength()+7)>>3);if(a==null){return null}var e=this.doPublic(a);if(e==null){return null}var b=e.toString(16);if((b.length&1)==0){return b}else{return"0"+b}}RSAKey.prototype.doPublic=RSADoPublic;RSAKey.prototype.setPublic=RSASetPublic;RSAKey.prototype.encrypt=RSAEncrypt;
// Minified and modified rsa2.js from JSBN library
function pkcs1unpad2(g,j){var a=g.toByteArray();var f=0;while(f<a.length&&a[f]==0){++f}if(a.length-f!=j-1||a[f]!=2){return null}++f;while(a[f]!=0){if(++f>=a.length){return null}}var e="";while(++f<a.length){var h=a[f]&255;if(h<128){e+=String.fromCharCode(h)}else{if((h>191)&&(h<224)){e+=String.fromCharCode(((h&31)<<6)|(a[f+1]&63));++f}else{e+=String.fromCharCode(((h&15)<<12)|((a[f+1]&63)<<6)|(a[f+2]&63));f+=2}}}return e}function RSASetPrivate(c,a,b){if(c!=null&&a!=null&&c.length>0&&a.length>0){this.n=parseBigInt(c,16);this.e=parseInt(a,16);this.d=parseBigInt(b,16)}else{alert(msg_invalidRSAPrivateKey)}}function RSASetPrivateEx(g,d,e,c,b,a,h,f){if(g!=null&&d!=null&&g.length>0&&d.length>0){this.n=parseBigInt(g,16);this.e=parseInt(d,16);this.d=parseBigInt(e,16);this.p=parseBigInt(c,16);this.q=parseBigInt(b,16);this.dmp1=parseBigInt(a,16);this.dmq1=parseBigInt(h,16);this.coeff=parseBigInt(f,16)}else{alert(msg_invalidRSAPrivateKey)}}function RSAGenerate(b,i){var a=new SecureRandom();var f=b>>1;this.e=parseInt(i,16);var c=new BigInteger(i,16);for(;;){for(;;){this.p=new BigInteger(b-f,1,a);if(this.p.subtract(BigInteger.ONE).gcd(c).compareTo(BigInteger.ONE)==0&&this.p.isProbablePrime(10)){break}}for(;;){this.q=new BigInteger(f,1,a);if(this.q.subtract(BigInteger.ONE).gcd(c).compareTo(BigInteger.ONE)==0&&this.q.isProbablePrime(10)){break}}if(this.p.compareTo(this.q)<=0){var h=this.p;this.p=this.q;this.q=h}var g=this.p.subtract(BigInteger.ONE);var d=this.q.subtract(BigInteger.ONE);var e=g.multiply(d);if(e.gcd(c).compareTo(BigInteger.ONE)==0){this.n=this.p.multiply(this.q);this.d=c.modInverse(e);this.dmp1=this.d.mod(g);this.dmq1=this.d.mod(d);this.coeff=this.q.modInverse(this.p);break}}}function RSADoPrivate(a){if(this.p==null||this.q==null){return a.modPow(this.d,this.n)}var c=a.mod(this.p).modPow(this.dmp1,this.p);var b=a.mod(this.q).modPow(this.dmq1,this.q);while(c.compareTo(b)<0){c=c.add(this.p)}return c.subtract(b).multiply(this.coeff).mod(this.p).multiply(this.q).add(b)}function RSADecrypt(b){var d=parseBigInt(b,16);var a=this.doPrivate(d);if(a==null){return null}return pkcs1unpad2(a,(this.n.bitLength()+7)>>3)}RSAKey.prototype.doPrivate=RSADoPrivate;RSAKey.prototype.setPrivate=RSASetPrivate;RSAKey.prototype.setPrivateEx=RSASetPrivateEx;RSAKey.prototype.generate=RSAGenerate;RSAKey.prototype.decrypt=RSADecrypt;
// Minified aes.js from crypto-js library
var CryptoJS=CryptoJS||function(o,e){var h={},g=h.lib={},z=function(){},y=g.Base={extend:function(b){z.prototype=this;var d=new z;b&&d.mixIn(b);d.hasOwnProperty("init")||(d.init=function(){d.$super.init.apply(this,arguments)});d.init.prototype=d;d.$super=this;return d},create:function(){var b=this.extend();b.init.apply(b,arguments);return b},init:function(){},mixIn:function(b){for(var d in b){b.hasOwnProperty(d)&&(this[d]=b[d])}b.hasOwnProperty("toString")&&(this.toString=b.toString)},clone:function(){return this.init.prototype.extend(this)}},a=g.WordArray=y.extend({init:function(b,d){b=this.words=b||[];this.sigBytes=d!=e?d:4*b.length},toString:function(b){return(b||m).stringify(this)},concat:function(b){var p=this.words,n=b.words,l=this.sigBytes;b=b.sigBytes;this.clamp();if(l%4){for(var d=0;d<b;d++){p[l+d>>>2]|=(n[d>>>2]>>>24-8*(d%4)&255)<<24-8*((l+d)%4)}}else{if(65535<n.length){for(d=0;d<b;d+=4){p[l+d>>>2]=n[d>>>2]}}else{p.push.apply(p,n)}}this.sigBytes+=b;return this},clamp:function(){var b=this.words,d=this.sigBytes;b[d>>>2]&=4294967295<<32-8*(d%4);b.length=o.ceil(d/4)},clone:function(){var b=y.clone.call(this);b.words=this.words.slice(0);return b},random:function(b){for(var l=[],d=0;d<b;d+=4){l.push(4294967296*o.random()|0)}return new a.init(l,b)}}),k=h.enc={},m=k.Hex={stringify:function(b){var p=b.words;b=b.sigBytes;for(var n=[],l=0;l<b;l++){var d=p[l>>>2]>>>24-8*(l%4)&255;n.push((d>>>4).toString(16));n.push((d&15).toString(16))}return n.join("")},parse:function(b){for(var n=b.length,l=[],d=0;d<n;d+=2){l[d>>>3]|=parseInt(b.substr(d,2),16)<<24-4*(d%8)}return new a.init(l,n/2)}},i=k.Latin1={stringify:function(b){var n=b.words;b=b.sigBytes;for(var l=[],d=0;d<b;d++){l.push(String.fromCharCode(n[d>>>2]>>>24-8*(d%4)&255))}return l.join("")},parse:function(b){for(var n=b.length,l=[],d=0;d<n;d++){l[d>>>2]|=(b.charCodeAt(d)&255)<<24-8*(d%4)}return new a.init(l,n)}},j=k.Utf8={stringify:function(b){try{return decodeURIComponent(escape(i.stringify(b)))}catch(d){throw Error("Malformed UTF-8 data")}},parse:function(b){return i.parse(unescape(encodeURIComponent(b)))}},c=g.BufferedBlockAlgorithm=y.extend({reset:function(){this._data=new a.init;this._nDataBytes=0},_append:function(b){"string"==typeof b&&(b=j.parse(b));this._data.concat(b);this._nDataBytes+=b.sigBytes},_process:function(l){var t=this._data,s=t.words,p=t.sigBytes,n=this.blockSize,d=p/(4*n),d=l?o.ceil(d):o.max((d|0)-this._minBufferSize,0);l=d*n;p=o.min(4*l,p);if(l){for(var r=0;r<l;r+=n){this._doProcessBlock(s,r)}r=s.splice(0,l);t.sigBytes-=p}return new a.init(r,p)},clone:function(){var b=y.clone.call(this);b._data=this._data.clone();return b},_minBufferSize:0});g.Hasher=c.extend({cfg:y.extend(),init:function(b){this.cfg=this.cfg.extend(b);this.reset()},reset:function(){c.reset.call(this);this._doReset()},update:function(b){this._append(b);this._process();return this},finalize:function(b){b&&this._append(b);return this._doFinalize()},blockSize:16,_createHelper:function(b){return function(d,l){return(new b.init(l)).finalize(d)}},_createHmacHelper:function(b){return function(d,l){return(new f.HMAC.init(b,l)).finalize(d)}}});var f=h.algo={};return h}(Math);(function(){var a=CryptoJS,b=a.lib.WordArray;a.enc.Base64={stringify:function(j){var e=j.words,i=j.sigBytes,g=this._map;j.clamp();j=[];for(var h=0;h<i;h+=3){for(var c=(e[h>>>2]>>>24-8*(h%4)&255)<<16|(e[h+1>>>2]>>>24-8*((h+1)%4)&255)<<8|e[h+2>>>2]>>>24-8*((h+2)%4)&255,f=0;4>f&&h+0.75*f<i;f++){j.push(g.charAt(c>>>6*(3-f)&63))}}if(e=g.charAt(64)){for(;j.length%4;){j.push(e)}}return j.join("")},parse:function(k){var f=k.length,i=this._map,h=i.charAt(64);h&&(h=k.indexOf(h),-1!=h&&(f=h));for(var h=[],j=0,e=0;e<f;e++){if(e%4){var g=i.indexOf(k.charAt(e-1))<<2*(e%4),c=i.indexOf(k.charAt(e))>>>6-2*(e%4);h[j>>>2]|=(g|c)<<24-8*(j%4);j++}}return b.create(h,j)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();(function(k){function c(d,s,l,r,q,p,o){d=d+(s&l|~s&r)+q+o;return(d<<p|d>>>32-p)+s}function f(d,s,l,r,q,p,o){d=d+(s&r|l&~r)+q+o;return(d<<p|d>>>32-p)+s}function e(d,s,l,r,q,p,o){d=d+(s^l^r)+q+o;return(d<<p|d>>>32-p)+s}function n(d,s,l,r,q,p,o){d=d+(l^(s|~r))+q+o;return(d<<p|d>>>32-p)+s}for(var m=CryptoJS,a=m.lib,i=a.WordArray,j=a.Hasher,a=m.algo,g=[],h=0;64>h;h++){g[h]=4294967296*k.abs(k.sin(h+1))|0}a=a.MD5=j.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(J,L){for(var U=0;16>U;U++){var T=L+U,S=J[T];J[T]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360}var U=this._hash.words,T=J[L+0],S=J[L+1],O=J[L+2],N=J[L+3],b=J[L+4],H=J[L+5],y=J[L+6],l=J[L+7],o=J[L+8],K=J[L+9],I=J[L+10],G=J[L+11],p=J[L+12],F=J[L+13],s=J[L+14],d=J[L+15],R=U[0],M=U[1],Q=U[2],P=U[3],R=c(R,M,Q,P,T,7,g[0]),P=c(P,R,M,Q,S,12,g[1]),Q=c(Q,P,R,M,O,17,g[2]),M=c(M,Q,P,R,N,22,g[3]),R=c(R,M,Q,P,b,7,g[4]),P=c(P,R,M,Q,H,12,g[5]),Q=c(Q,P,R,M,y,17,g[6]),M=c(M,Q,P,R,l,22,g[7]),R=c(R,M,Q,P,o,7,g[8]),P=c(P,R,M,Q,K,12,g[9]),Q=c(Q,P,R,M,I,17,g[10]),M=c(M,Q,P,R,G,22,g[11]),R=c(R,M,Q,P,p,7,g[12]),P=c(P,R,M,Q,F,12,g[13]),Q=c(Q,P,R,M,s,17,g[14]),M=c(M,Q,P,R,d,22,g[15]),R=f(R,M,Q,P,S,5,g[16]),P=f(P,R,M,Q,y,9,g[17]),Q=f(Q,P,R,M,G,14,g[18]),M=f(M,Q,P,R,T,20,g[19]),R=f(R,M,Q,P,H,5,g[20]),P=f(P,R,M,Q,I,9,g[21]),Q=f(Q,P,R,M,d,14,g[22]),M=f(M,Q,P,R,b,20,g[23]),R=f(R,M,Q,P,K,5,g[24]),P=f(P,R,M,Q,s,9,g[25]),Q=f(Q,P,R,M,N,14,g[26]),M=f(M,Q,P,R,o,20,g[27]),R=f(R,M,Q,P,F,5,g[28]),P=f(P,R,M,Q,O,9,g[29]),Q=f(Q,P,R,M,l,14,g[30]),M=f(M,Q,P,R,p,20,g[31]),R=e(R,M,Q,P,H,4,g[32]),P=e(P,R,M,Q,o,11,g[33]),Q=e(Q,P,R,M,G,16,g[34]),M=e(M,Q,P,R,s,23,g[35]),R=e(R,M,Q,P,S,4,g[36]),P=e(P,R,M,Q,b,11,g[37]),Q=e(Q,P,R,M,l,16,g[38]),M=e(M,Q,P,R,I,23,g[39]),R=e(R,M,Q,P,F,4,g[40]),P=e(P,R,M,Q,T,11,g[41]),Q=e(Q,P,R,M,N,16,g[42]),M=e(M,Q,P,R,y,23,g[43]),R=e(R,M,Q,P,K,4,g[44]),P=e(P,R,M,Q,p,11,g[45]),Q=e(Q,P,R,M,d,16,g[46]),M=e(M,Q,P,R,O,23,g[47]),R=n(R,M,Q,P,T,6,g[48]),P=n(P,R,M,Q,l,10,g[49]),Q=n(Q,P,R,M,s,15,g[50]),M=n(M,Q,P,R,H,21,g[51]),R=n(R,M,Q,P,p,6,g[52]),P=n(P,R,M,Q,N,10,g[53]),Q=n(Q,P,R,M,I,15,g[54]),M=n(M,Q,P,R,S,21,g[55]),R=n(R,M,Q,P,o,6,g[56]),P=n(P,R,M,Q,d,10,g[57]),Q=n(Q,P,R,M,y,15,g[58]),M=n(M,Q,P,R,F,21,g[59]),R=n(R,M,Q,P,b,6,g[60]),P=n(P,R,M,Q,G,10,g[61]),Q=n(Q,P,R,M,O,15,g[62]),M=n(M,Q,P,R,K,21,g[63]);U[0]=U[0]+R|0;U[1]=U[1]+M|0;U[2]=U[2]+Q|0;U[3]=U[3]+P|0},_doFinalize:function(){var d=this._data,q=d.words,l=8*this._nDataBytes,p=8*d.sigBytes;q[p>>>5]|=128<<24-p%32;var o=k.floor(l/4294967296);q[(p+64>>>9<<4)+15]=(o<<8|o>>>24)&16711935|(o<<24|o>>>8)&4278255360;q[(p+64>>>9<<4)+14]=(l<<8|l>>>24)&16711935|(l<<24|l>>>8)&4278255360;d.sigBytes=4*(q.length+1);this._process();d=this._hash;q=d.words;for(l=0;4>l;l++){p=q[l],q[l]=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360}return d},clone:function(){var d=j.clone.call(this);d._hash=this._hash.clone();return d}});m.MD5=j._createHelper(a);m.HmacMD5=j._createHmacHelper(a)})(Math);(function(){var b=CryptoJS,e=b.lib,f=e.Base,a=e.WordArray,e=b.algo,c=e.EvpKDF=f.extend({cfg:f.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(g){this.cfg=this.cfg.extend(g)},compute:function(k,g){for(var i=this.cfg,t=i.hasher.create(),l=a.create(),o=l.words,h=i.keySize,i=i.iterations;o.length<h;){j&&t.update(j);var j=t.update(k).finalize(g);t.reset();for(var m=1;m<i;m++){j=t.finalize(j),t.reset()}l.concat(j)}l.sigBytes=4*h;return l}});b.EvpKDF=function(i,g,h){return c.create(h).compute(i,g)}})();CryptoJS.lib.Cipher||function(B){var g=CryptoJS,j=g.lib,i=j.Base,D=j.WordArray,C=j.BufferedBlockAlgorithm,e=g.enc.Base64,z=g.algo.EvpKDF,A=j.Cipher=C.extend({cfg:i.extend(),createEncryptor:function(c,b){return this.create(this._ENC_XFORM_MODE,c,b)},createDecryptor:function(c,b){return this.create(this._DEC_XFORM_MODE,c,b)},init:function(l,d,c){this.cfg=this.cfg.extend(c);this._xformMode=l;this._key=d;this.reset()},reset:function(){C.reset.call(this);this._doReset()},process:function(a){this._append(a);return this._process()},finalize:function(a){a&&this._append(a);return this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(a){return{encrypt:function(c,l,n){return("string"==typeof l?k:o).encrypt(a,c,l,n)},decrypt:function(c,l,n){return("string"==typeof l?k:o).decrypt(a,c,l,n)}}}});j.StreamCipher=A.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var m=g.mode={},y=function(p,n,l){var r=this._iv;r?this._iv=B:r=this._prevBlock;for(var q=0;q<l;q++){p[n+q]^=r[q]}},f=(j.BlockCipherMode=i.extend({createEncryptor:function(c,b){return this.Encryptor.create(c,b)},createDecryptor:function(c,b){return this.Decryptor.create(c,b)},init:function(c,b){this._cipher=c;this._iv=b}})).extend();f.Encryptor=f.extend({processBlock:function(n,l){var d=this._cipher,p=d.blockSize;y.call(this,n,l,p);d.encryptBlock(n,l);this._prevBlock=n.slice(l,l+p)}});f.Decryptor=f.extend({processBlock:function(p,n){var l=this._cipher,r=l.blockSize,q=p.slice(n,n+r);l.decryptBlock(p,n);y.call(this,p,n,r);this._prevBlock=q}});m=m.CBC=f;f=(g.pad={}).Pkcs7={pad:function(r,p){for(var u=4*p,u=u-r.sigBytes%u,s=u<<24|u<<16|u<<8|u,q=[],t=0;t<u;t+=4){q.push(s)}u=D.create(q,u);r.concat(u)},unpad:function(b){b.sigBytes-=b.words[b.sigBytes-1>>>2]&255}};j.BlockCipher=A.extend({cfg:A.cfg.extend({mode:m,padding:f}),reset:function(){A.reset.call(this);var l=this.cfg,d=l.iv,l=l.mode;if(this._xformMode==this._ENC_XFORM_MODE){var n=l.createEncryptor}else{n=l.createDecryptor,this._minBufferSize=1}this._mode=n.call(l,this,d&&d.words)},_doProcessBlock:function(d,c){this._mode.processBlock(d,c)},_doFinalize:function(){var d=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){d.pad(this._data,this.blockSize);var c=this._process(!0)}else{c=this._process(!0),d.unpad(c)}return c},blockSize:4});var h=j.CipherParams=i.extend({init:function(b){this.mixIn(b)},toString:function(b){return(b||this.formatter).stringify(this)}}),m=(g.format={}).OpenSSL={stringify:function(d){var c=d.ciphertext;d=d.salt;return(d?D.create([1398893684,1701076831]).concat(d).concat(c):c).toString(e)},parse:function(l){l=e.parse(l);var d=l.words;if(1398893684==d[0]&&1701076831==d[1]){var n=D.create(d.slice(2,4));d.splice(0,4);l.sigBytes-=16}return h.create({ciphertext:l,salt:n})}},o=j.SerializableCipher=i.extend({cfg:i.extend({format:m}),encrypt:function(q,n,s,r){r=this.cfg.extend(r);var p=q.createEncryptor(s,r);n=p.finalize(n);p=p.cfg;return h.create({ciphertext:n,key:s,iv:p.iv,algorithm:q,mode:p.mode,padding:p.padding,blockSize:q.blockSize,formatter:r.format})},decrypt:function(n,l,q,p){p=this.cfg.extend(p);l=this._parse(l,p.format);return n.createDecryptor(q,p).finalize(l.ciphertext)},_parse:function(d,c){return"string"==typeof d?c.parse(d,this):d}}),g=(g.kdf={}).OpenSSL={execute:function(n,l,q,p){p||(p=D.random(8));n=z.create({keySize:l+q}).compute(n,p);q=D.create(n.words.slice(l),4*q);n.sigBytes=4*l;return h.create({key:n,iv:q,salt:p})}},k=j.PasswordBasedCipher=o.extend({cfg:o.cfg.extend({kdf:g}),encrypt:function(a,q,p,n){n=this.cfg.extend(n);p=n.kdf.execute(p,a.keySize,a.ivSize);n.iv=p.iv;a=o.encrypt.call(this,a,q,p.key,n);a.mixIn(p);return a},decrypt:function(a,q,p,n){n=this.cfg.extend(n);q=this._parse(q,n.format);p=n.kdf.execute(p,a.keySize,a.ivSize,q.salt);n.iv=p.iv;return o.decrypt.call(this,a,q,p.key,n)}})}();(function(){for(var C=CryptoJS,K=C.lib.BlockCipher,Q=C.algo,M=[],E=[],D=[],I=[],m=[],A=[],S=[],h=[],J=[],L=[],T=[],R=0;256>R;R++){T[R]=128>R?R<<1:R<<1^283}for(var P=0,O=0,R=0;256>R;R++){var N=O^O<<1^O<<2^O<<3^O<<4,N=N>>>8^N&255^99;M[P]=N;E[N]=P;var f=T[P],B=T[f],o=T[B],g=257*T[N]^16843008*N;D[P]=g<<24|g>>>8;I[P]=g<<16|g>>>16;m[P]=g<<8|g>>>24;A[P]=g;g=16843009*o^65537*B^257*f^16843008*P;S[N]=g<<24|g>>>8;h[N]=g<<16|g>>>16;J[N]=g<<8|g>>>24;L[N]=g;P?(P=f^T[T[T[o^f]]],O^=T[T[O]]):P=O=1}var i=[0,1,2,4,8,16,32,64,128,27,54],Q=Q.AES=K.extend({_doReset:function(){for(var b=this._key,r=b.words,q=b.sigBytes/4,b=4*((this._nRounds=q+6)+1),p=this._keySchedule=[],n=0;n<b;n++){if(n<q){p[n]=r[n]}else{var l=p[n-1];n%q?6<q&&4==n%q&&(l=M[l>>>24]<<24|M[l>>>16&255]<<16|M[l>>>8&255]<<8|M[l&255]):(l=l<<8|l>>>24,l=M[l>>>24]<<24|M[l>>>16&255]<<16|M[l>>>8&255]<<8|M[l&255],l^=i[n/q|0]<<24);p[n]=p[n-q]^l}}r=this._invKeySchedule=[];for(q=0;q<b;q++){n=b-q,l=q%4?p[n]:p[n-4],r[q]=4>q||4>=n?l:S[M[l>>>24]]^h[M[l>>>16&255]]^J[M[l>>>8&255]]^L[M[l&255]]}},encryptBlock:function(d,c){this._doCryptBlock(d,c,this._keySchedule,D,I,m,A,M)},decryptBlock:function(b,j){var e=b[j+1];b[j+1]=b[j+3];b[j+3]=e;this._doCryptBlock(b,j,this._invKeySchedule,S,h,J,L,E);e=b[j+1];b[j+1]=b[j+3];b[j+3]=e},_doCryptBlock:function(ac,ab,aa,Z,Y,U,G,X){for(var F=this._nRounds,W=ac[ab]^aa[0],V=ac[ab+1]^aa[1],H=ac[ab+2]^aa[2],z=ac[ab+3]^aa[3],y=4,w=1;w<F;w++){var x=Z[W>>>24]^Y[V>>>16&255]^U[H>>>8&255]^G[z&255]^aa[y++],v=Z[V>>>24]^Y[H>>>16&255]^U[z>>>8&255]^G[W&255]^aa[y++],u=Z[H>>>24]^Y[z>>>16&255]^U[W>>>8&255]^G[V&255]^aa[y++],z=Z[z>>>24]^Y[W>>>16&255]^U[V>>>8&255]^G[H&255]^aa[y++],W=x,V=v,H=u}x=(X[W>>>24]<<24|X[V>>>16&255]<<16|X[H>>>8&255]<<8|X[z&255])^aa[y++];v=(X[V>>>24]<<24|X[H>>>16&255]<<16|X[z>>>8&255]<<8|X[W&255])^aa[y++];u=(X[H>>>24]<<24|X[z>>>16&255]<<16|X[W>>>8&255]<<8|X[V&255])^aa[y++];z=(X[z>>>24]<<24|X[W>>>16&255]<<16|X[V>>>8&255]<<8|X[H&255])^aa[y++];ac[ab]=x;ac[ab+1]=v;ac[ab+2]=u;ac[ab+3]=z},keySize:8});C.AES=K._createHelper(Q)})();
// Specific code
function init()
{
	document.getElementById('nbAttachements').value = 0;
	document.getElementById('allAttachments').value = '';
	document.getElementById("lnkForward").innerHTML = "../..";
	
	if(privateKeyFound) {
		document.getElementById("loadPrivateKey").innerHTML = "";
		document.getElementById("filePrivateKey").value = pKeyValue;
	}
	if(receiverKeyFound) {
		document.getElementById("loadReceiverKey").innerHTML = "";
		document.getElementById("fileAESKey").value = receiverKeyValue;
	}
}

function saveTextAsFile(idTextContent,fileNameToSaveAs)
{
	var textToWrite = document.getElementById(idTextContent).value;
	var textFileAsBlob = new Blob([textToWrite], {type:'text/plain'});
	
	var downloadLink = document.createElement("a");
	downloadLink.download = fileNameToSaveAs;
	downloadLink.innerHTML = "Download";
	if (window.webkitURL != null)
	{
		downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob);
	}
	else
	{
		downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
		downloadLink.onclick = destroyClickedElement;
		downloadLink.style.display = "none";
		document.body.appendChild(downloadLink);
	}

	downloadLink.click();
}

function readAKey(f,prefixK,sortie,nomSortie){
	var reader = new FileReader();
	setTimeout("toggle_visibility('inProgress')",10);
	reader.readAsText(f);
	
	reader.onload = function() {
		var text = reader.result;
		setTimeout("toggle_visibility('inProgress')",10);
		document.getElementById(sortie).value = text.substring(prefixK.length,(text.length-2));
	}
	reader.onerror = function(e) {
		console.log("Error", e);
	};
	document.getElementById(nomSortie).innerHTML=f.name;
}

function readAESKey(f) {
	readAKey(f,"var receiverKeyFound=true;var receiverKeyValue='",'fileAESKey','lblFileAESKeyinput');
}

function readPrivateKey(f){
	readAKey(f,"var privateKeyFound=true;var pKeyValue='",'filePrivateKey','lblFilePrivateKeyInput');
}

function readAttachment(f,attNumber) {
	var reader = new FileReader();
	setTimeout("toggle_visibility('inProgress')",10);
	reader.readAsDataURL(f);
	
	reader.onload = function() {
		var text = reader.result;
		setTimeout("toggle_visibility('inProgress')",10);
		document.getElementById('allAttachments').value += f.name+';'+text.length+';'+text+';';
	}
	reader.onerror = function(e) {
		console.log("Error", e);
	};
	document.getElementById('div'+attNumber+'inputname').innerHTML=f.name;
}

function addAnotherFile()
{
	var attNumber = 1+(parseInt(document.getElementById('nbAttachements').value));
	var strOnChange = "readAttachment(this.files[0],"+attNumber+");";
	var strMoreAtt = lblAttachment+' '+attNumber+':<br/>';
	strMoreAtt += '<label class="custom-upload"><input type="file" id="fileAttachement'+attNumber+'input" onchange="'+strOnChange+'"/>'+lblUpload+'</label><div id="div'+attNumber+'inputname"></div><br/>';
	newDiv = document.createElement("div");
	newDiv.id = 'divAtt'+attNumber;
	newDiv.innerHTML = strMoreAtt;
	document.getElementById('moreAttachements').appendChild(newDiv);
	document.getElementById('nbAttachements').value = attNumber;
}
  
function do_decrypt(text,exponent,PrivateKey) {
  var cval = "";
  var arrKg = PrivateKey.split(';');
  var rsa = new RSAKey();
  var n = arrKg[1];
  var d = arrKg[2];
  var p = arrKg[3];
  var q = arrKg[4];
  var dmp1 = arrKg[5];
  var dmq1 = arrKg[6];
  var coeff = arrKg[7];
  rsa.setPrivateEx(n, exponent, d, p, q, dmp1, dmq1, coeff);
  if(text.length == 0) {
    return;
  }
  var res = rsa.decrypt(text);
  if(res == null) {
    cval = "";
  }
  else {
    cval = res;
  }
  return cval;
}

function toggle_visibility(id) {
   var e = document.getElementById(id);
   if(e.style.display == 'block')
	  e.style.display = 'none';
   else
	  e.style.display = 'block';
}

function messageGeneration() {
	setTimeout("toggle_visibility('inProgress')",10);
	var dr = document.frmRsa;
	var e_value = "10001";
	
	var receiverKey = do_decrypt(dr.fileAESKey.value,e_value,dr.filePrivateKey.value);
	var encryptedMsg = "";
	document.getElementById("lnkForward").innerHTML = lblErrorInvalidPublicKey;
	if (receiverKey.length>0) {
		var entireMsg = dr.message.value;
		entireMsg = "[" + entireMsg.length + "];" + entireMsg + ";" + document.getElementById('allAttachments').value;
		encryptedMsg = CryptoJS.AES.encrypt(entireMsg, receiverKey);
		document.getElementById('allAttachments').value = entireMsg;
		document.getElementById("lblForward").innerHTML = lblForwardInnerHTML;
		document.getElementById("lnkForward").innerHTML = "<a target=\"_blank\" download=\""+lbl_nameFileYourEncryptedMessage+"\" href=\"data:text/plain;charset=utf-8,"+encryptedMsg+"\" class=\"button\">"+lbl_yourEncryptedMessage+"</a>";
	}
	setTimeout("toggle_visibility('inProgress')",10);
}

//-->
</script>
	</head>
	<body onload="init();">
		<h2>=== ENCRYPTION ===</h2>
		<h3>Encrypt a message</h3>
		<div class="paragraph">
			To encrypt a message, fill in the following form:
		</div>
		<div class="paragraph">
		<form name="frmRsa">
			<div id="loadPrivateKey">
			Download your private key which was generated at the previous setup step. Next time, copy it in the same directory as this page in order 
			to let it be automatically detected.<br/>
			<label class="custom-upload"><input type="file" id="filePrivateKeyInput"  onchange="readPrivateKey(this.files[0]);"/>Browse...</label><br/>
			</div>
			<div id="lblFilePrivateKeyInput"></div>
			<br/>
			<input type="hidden" id="filePrivateKey"/>
			
			<div id="loadReceiverKey">
			Upload the cypher key which was sent to you previously. Next time, copy it in the same directory as this page in order to let it be
			automatically detected.<br/>
			<label class="custom-upload"><input type="file" id="fileAESKeyinput"  onchange="readAESKey(this.files[0]);"/>Browse...</label><br/>
			</div>
			<div id="lblFileAESKeyinput"></div>
			<input type="hidden" id="fileAESKey"/>
			<br/>Type the message to encrypt:<br/>
			<textarea name="message" rows="4" cols="70"></textarea><br/>
			<input type="hidden" id="nbAttachements" value="0"/>
			<input type="hidden" id="allAttachments" value=""/>
			<div id="moreAttachements"></div>
			It is possible to attach one or several files to this message:
			<br/><input type='button' id='btnMoreAtt' value='Add a file' onclick='addAnotherFile();' class='button'><br/>
			<br/><input type='button' id='btnLoad' value='Next' onclick='messageGeneration();' class='button'>
		</form>
		</div>
		<div id="inProgress"><span>Please wait...</span></div>
		<div class="paragraph">
			<div id="lblForward"></div>
			<br/><br/>
			<input type="hidden" id="inputEncryptedMsg"/>
			<div id="lnkForward">../..</div>
		</div>
		<footer id="copyright">
			<div class="copyr">&copy; 2016 - Powered by <a href="#">yoursite.com</a></div>
		</footer>
	</body>
</html>